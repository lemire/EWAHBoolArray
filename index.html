<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.12.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>EWAHBoolArray: Compressed bitset in C++</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">EWAHBoolArray<span id="projectnumber">&#160;0.8.0</span>
   </div>
   <div id="projectbrief">A compressed bitmap class in C++</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('index.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Compressed bitset in C++ </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md__r_e_a_d_m_e"></a></p>
<ul>
<li>Compressed bitset in C++<ul>
<li>What is this?</li>
<li>Real-world usage</li>
<li>When should you use a bitmap?</li>
<li>When should you use compressed bitmaps?</li>
<li>How does EWAH compares with the alternatives?</li>
</ul>
</li>
<li>API</li>
<li>Licensing</li>
<li>Dependencies</li>
<li>Usage (Linux and Linux-like systems)</li>
<li>Usage (Visual Studio under Windows)</li>
<li>Quick code sample</li>
<li>Example</li>
<li>Further reading</li>
<li>Wrappers<ul>
<li>Node/JavaScript wrapper</li>
<li>Ruby wrapper</li>
</ul>
</li>
<li>Persistent storage</li>
</ul>
<h1><a class="anchor" id="autotoc_md1"></a>
What is this?</h1>
<p>The class EWAHBoolArray is a compressed bitset data structure. It supports several word sizes by a template parameter (16-bit, 32-bit, 64-bit). You should expect the 64-bit word-size to provide better performance, but higher memory usage, while a 32-bit word-size might compress a bit better, at the expense of some performance.</p>
<p>The library also provides a basic BoolArray class which can serve as a traditional bitmap.</p>
<h1><a class="anchor" id="autotoc_md2"></a>
Real-world usage</h1>
<p><a href="http://githubengineering.com/counting-objects/">EWAH is used to accelerate the distributed version control system Git</a>.</p>
<p>The Java counterpart of this library (JavaEWAH) is part of Apache Hive and its derivatives (e.g., Apache Spark) and Eclipse JGit. It has been used in production systems for many years. It is part of major Linux distributions.</p>
<p>This library is used by <a href="https://github.com/chango/hustle">Hustle &ndash; A column oriented, embarrassingly distributed relational event database</a>, by the <a href="https://github.com/yt-project/yt">The yt Project</a> and by <a href="https://github.com/vusec/vuzzer64">the fuzzing tool VUzzer</a>.</p>
<h1><a class="anchor" id="autotoc_md3"></a>
When should you use a bitmap?</h1>
<p>Sets are a fundamental abstraction in software. They can be implemented in various ways, as hash sets, as trees, and so forth. In databases and search engines, sets are often an integral part of indexes. For example, we may need to maintain a set of all documents or rows (represented by numerical identifier) that satisfy some property. Besides adding or removing elements from the set, we need fast functions to compute the intersection, the union, the difference between sets, and so on.</p>
<p>To implement a set of integers, a particularly appealing strategy is the bitmap (also called bitset or bit vector). Using n bits, we can represent any set made of the integers from the range [0,n): it suffices to set the ith bit is set to one if integer i is present in the set. Commodity processors use words of W=32 or W=64 bits. By combining many such words, we can support large values of n. Intersections, unions and differences can then be implemented as bitwise AND, OR and ANDNOT operations. More complicated set functions can also be implemented as bitwise operations.</p>
<p>When the bitset approach is applicable, it can be orders of magnitude faster than other possible implementation of a set (e.g., as a hash set) while using several times less memory.</p>
<h1><a class="anchor" id="autotoc_md4"></a>
When should you use compressed bitmaps?</h1>
<p>An uncompressed BitSet can use a lot of memory. For example, if you take a BitSet and set the bit at position 1,000,000 to true and you have just over 100kB. That's over 100kB to store the position of one bit. This is wasteful even if you do not care about memory: suppose that you need to compute the intersection between this BitSet and another one that has a bit at position 1,000,001 to true, then you need to go through all these zeroes, whether you like it or not. That can become very wasteful.</p>
<p>This being said, there are definitively cases where attempting to use compressed bitmaps is wasteful. For example, if you have a small universe size. E.g., your bitmaps represent sets of integers from [0,n) where n is small (e.g., n=64 or n=128). If you can use an BitSet and it does not blow up your memory usage, then compressed bitmaps are probably not useful to you. In fact, if you do not need compression, then a BitSet offers remarkable speed. One of the downsides of a compressed bitmap like those provided by EWAHBoolArray is slower random access: checking whether a bit is set to true in a compressed bitmap takes longer.</p>
<h1><a class="anchor" id="autotoc_md5"></a>
How does EWAH compares with the alternatives?</h1>
<p>EWAH is part of a larger family of compressed bitmaps that are run-length-encoded bitmaps. They identify long runs of 1s or 0s and they represent them with a marker word. If you have a local mix of 1s and 0, you use an uncompressed word.</p>
<p>There are many formats in this family beside EWAH:</p>
<ul>
<li>Oracle's BBC is an obsolete format at this point: though it may provide good compression, it is likely much slower than more recent alternatives due to excessive branching.</li>
<li>WAH is a patented variation on BBC that provides better performance.</li>
<li>Concise is a variation on the patented WAH. It some specific instances, it can compress much better than WAH (up to 2x better), but it is generally slower.</li>
<li>EWAH is both free of patent, and it is faster than all the above. On the downside, it does not compress quite as well. It is faster because it allows some form of "skipping" over uncompressed words. So though none of these formats are great at random access, EWAH is better than the alternatives.</li>
</ul>
<p>There are other alternatives however. For example, the <a href="https://github.com/lemire/RoaringBitmap">Roaring format</a> is not a run-length-encoded hybrid. It provides faster random access than even EWAH.</p>
<h1><a class="anchor" id="autotoc_md6"></a>
API</h1>
<p>Please see our main header file:</p>
<p><a href="https://github.com/lemire/EWAHBoolArray/blob/master/include/ewah/ewah.h">https://github.com/lemire/EWAHBoolArray/blob/master/include/ewah/ewah.h</a></p>
<h1><a class="anchor" id="autotoc_md7"></a>
Licensing</h1>
<p>The EWAHBoolArray project is under a dual license (Apache/MIT). Users of the library may choose one or the other license.</p>
<h1><a class="anchor" id="autotoc_md8"></a>
Dependencies</h1>
<p>None. (Will work under MacOS, Windows or Linux.)</p>
<p>Compilers tested: clang++, g++, Intel compiler, Microsoft Visual Studio</p>
<p>It works on x64 processors as well as on 32-bit ARM processors.</p>
<p>Versions 0.5 and above assume that the compiler supports the C++11 standard.</p>
<h1><a class="anchor" id="autotoc_md9"></a>
Usage (Linux and Linux-like systems)</h1>
<pre class="fragment">cmake -B build 
cmake --build build
cd build
ctest --test-dir build
</pre><h1><a class="anchor" id="autotoc_md10"></a>
Usage (Visual Studio under Windows)</h1>
<p>To build with at least Visual Studio 2017 directly in the IDE:</p><ul>
<li>Grab the code from GitHub, e.g., by cloning it using <a href="https://desktop.github.com/">GitHub Desktop</a>.</li>
<li>Select the <code>Visual C++ tools for CMake</code> optional component when installing the C++ Development Workload within Visual Studio.</li>
<li>Within Visual Studio use <code>File &gt; Open &gt; Folder...</code> to open the CRoaring folder.</li>
<li>Right click on <code>CMakeLists.txt</code> in the parent directory within <code>Solution Explorer</code> and select <code>Build</code> to build the project.</li>
<li>For testing, in the Standard toolbar, drop the <code>Select Startup Item...</code> menu and choose one of the tests. Run the test by pressing the button to the left of the dropdown.</li>
</ul>
<h1><a class="anchor" id="autotoc_md11"></a>
Quick code sample</h1>
<div class="fragment"><div class="line">++</div>
<div class="line"><span class="preprocessor"> #include &quot;ewah.h&quot;</span></div>
<div class="line"> <span class="keyword">using namespace </span>ewah;</div>
<div class="line"> </div>
<div class="line"> <span class="keyword">typedef</span> <a class="code hl_class" href="classewah_1_1_e_w_a_h_bool_array.html">EWAHBoolArray&lt;uint32_t&gt;</a> bitmap;</div>
<div class="line"> </div>
<div class="line"> bitmap bitset1 =</div>
<div class="line">     bitmap::bitmapOf(9, 1, 2, 1000, 1001, 1002, 1003, 1007, 1009, 100000);</div>
<div class="line"> std::cout &lt;&lt; <span class="stringliteral">&quot;first bitset : &quot;</span> &lt;&lt; bitset1 &lt;&lt; std::endl;</div>
<div class="line"> bitmap bitset2 = bitmap::bitmapOf(5, 1, 3, 1000, 1007, 100000);</div>
<div class="line"> std::cout &lt;&lt; <span class="stringliteral">&quot;second bitset : &quot;</span> &lt;&lt; bitset2 &lt;&lt; std::endl;</div>
<div class="line"> bitmap bitset3 = bitmap::bitmapOf(3, 10, 11, 12);</div>
<div class="line"> std::cout &lt;&lt; <span class="stringliteral">&quot;third  bitset : &quot;</span> &lt;&lt; bitset3 &lt;&lt; std::endl;</div>
<div class="line"> bitmap orbitset = bitset1 | bitset2;</div>
<div class="line"> bitmap andbitset = bitset1 &amp; bitset2;</div>
<div class="line"> bitmap xorbitset = bitset1 ^ bitset2;</div>
<div class="line"> bitmap andnotbitset = bitset1 - bitset2;</div>
<div class="ttc" id="aclassewah_1_1_e_w_a_h_bool_array_html"><div class="ttname"><a href="classewah_1_1_e_w_a_h_bool_array.html">ewah::EWAHBoolArray</a></div><div class="ttdoc">This class is a compressed bitmap.</div><div class="ttdef"><b>Definition</b> <a href="runninglengthword_8h_source.html#l00197">runninglengthword.h:197</a></div></div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md12"></a>
Example</h1>
<p>Please see <code>examples/example.cpp</code>. For an example with tabular data, please see <code>example2.cpp</code>.</p>
<h1><a class="anchor" id="autotoc_md13"></a>
Further reading</h1>
<p>Please see</p>
<ul>
<li>Daniel Lemire, Owen Kaser, Nathan Kurz, Luca Deri, Chris O'Hara, Fran√ßois Saint-Jacques, Gregory Ssi-Yan-Kai, Roaring Bitmaps: Implementation of an Optimized Software Library, Software: Practice and Experience 48 (4), 2018 <a href="https://arxiv.org/abs/1709.07821">arXiv:1709.07821</a></li>
<li>Daniel Lemire, Owen Kaser, Kamel Aouiche, Sorting improves word-aligned bitmap indexes. Data &amp; Knowledge Engineering 69 (1), pages 3-28, 2010. <a href="http://arxiv.org/abs/0901.3751">http://arxiv.org/abs/0901.3751</a></li>
<li>Owen Kaser and Daniel Lemire, Compressed bitmap indexes: beyond unions and intersections, Software: Practice and Experience 46 (2), 2016. <a href="http://arxiv.org/abs/1402.4466">http://arxiv.org/abs/1402.4466</a></li>
</ul>
<h1><a class="anchor" id="autotoc_md14"></a>
Wrappers</h1>
<h2><a class="anchor" id="autotoc_md15"></a>
Node/JavaScript wrapper</h2>
<p>Dimitrios Vasilas wrote a <a href="https://github.com/dvasilas/node-bitmap-ewah">wrapper for JavaScript</a>.</p>
<p>You can install it by typing: </p><pre class="fragment">    npm install -g node-gyp
    npm install node-bitmap-ewah
</pre><h2><a class="anchor" id="autotoc_md16"></a>
Ruby wrapper</h2>
<p>Josh Ferguson wrote a <a href="https://github.com/besquared/ewah-bitset/">wrapper for Ruby</a>. The implementation is packaged and installable as a ruby gem.</p>
<p>You can install it by typing: </p><pre class="fragment">    gem install ewah-bitset
</pre><h1><a class="anchor" id="autotoc_md17"></a>
Persistent storage</h1>
<p>We provide read and write functions.</p>
<p>We do not correct for the endianess. If you use both little endian and big endian machines, you should be careful. Thankfully, big endian hardware is vanishingly rare.</p>
<p>When loading data from an untrusted source, we recommend that you use hashes to validate the content. </p>
</div></div><!-- PageDoc -->
<a href="doxygen_crawl.html"></a>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.12.0 </li>
  </ul>
</div>
</body>
</html>
